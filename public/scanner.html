<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Rahl Quantum • Session Scanner</title>
<style>
  :root{
    --neon:#25d366;
    --bg:#050b08;
    --grid:#0c1914;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    background:
      radial-gradient(ellipse at center, rgba(37,211,102,.05), transparent 60%),
      linear-gradient(0deg, transparent 24%, rgba(255,255,255,.03) 25%, rgba(255,255,255,.03) 26%, transparent 27%, transparent 74%, rgba(255,255,255,.03) 75%, rgba(255,255,255,.03) 76%, transparent 77%),
      linear-gradient(90deg, transparent 24%, rgba(255,255,255,.03) 25%, rgba(255,255,255,.03) 26%, transparent 27%, transparent 74%, rgba(255,255,255,.03) 75%, rgba(255,255,255,.03) 76%, transparent 77%),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"><text x="0" y="20" fill="%230b3" font-family="monospace" font-size="18">0100110010101001</text></svg>') repeat;
    background-size: 100% 100%, 50px 50px, 50px 50px, 120px 120px;
    background-color:var(--bg);
    color:#bfffd5; font-family: "Segoe UI", system-ui, -apple-system, Roboto, Arial, sans-serif;
  }

  .wrap{ width:min(920px,92vw); padding:28px; text-align:center}
  h1{ margin:0 0 18px; font-weight:700; letter-spacing:.5px; color:#dfffe9 }
  .sub{ opacity:.8; margin-bottom:28px }

  .panel{
    background: rgba(0,0,0,.35);
    border:1px solid rgba(37,211,102,.2);
    border-radius:18px; padding:22px;
    box-shadow: 0 0 40px rgba(37,211,102,.08) inset, 0 12px 40px rgba(0,0,0,.6);
  }

  /* Neon circle */
  .ring{
    position:relative; width:min(420px,90vw); height:min(420px,90vw); margin:18px auto 14px;
    border-radius:50%;
    background: radial-gradient(circle at 50% 50%, rgba(37,211,102,.05), rgba(0,0,0,.2) 60%);
    box-shadow:
      0 0 18px rgba(37,211,102,.35),
      inset 0 0 40px rgba(37,211,102,.15);
  }
  .ring::before, .ring::after{
    content:""; position:absolute; inset:-10px;
    border-radius:50%; border:10px solid rgba(37,211,102,.25);
    filter: blur(1px);
  }
  .ring::after{
    border-top-color:var(--neon); border-right-color:transparent; border-bottom-color:transparent; border-left-color:transparent;
    animation: spin 2.4s linear infinite;
    box-shadow: 0 0 30px var(--neon), inset 0 0 18px var(--neon);
  }
  @keyframes spin{ to{ transform:rotate(360deg)}}

  .ring-core{
    position:absolute; inset:28px; border-radius:50%;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    background: radial-gradient(circle at 50% 40%, rgba(37,211,102,.08), rgba(0,0,0,.35));
    box-shadow: inset 0 0 30px rgba(37,211,102,.2);
    padding:22px;
  }

  .status{
    font-family: "Consolas","Menlo",monospace;
    font-size: clamp(16px, 2.5vw, 22px);
    letter-spacing: 2px;
    color:#a6ffd0;
    text-shadow: 0 0 12px rgba(37,211,102,.8);
  }
  .tiny{ font-size:12px; opacity:.8; margin-top:8px }

  .code{
    margin-top:12px;
    font-family: "Consolas","Menlo",monospace;
    font-size: clamp(18px, 3.2vw, 26px);
    color:#00ff95; word-break: break-all;
    background: rgba(0,0,0,.35);
    border:1px solid rgba(37,211,102,.35);
    padding:10px 12px; border-radius:10px;
    max-width: 90%;
  }

  .controls{ margin-top:18px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center }
  button, input{
    border-radius:12px; border:1px solid rgba(37,211,102,.3);
    padding:12px 14px; background:#0a1410; color:#dfffe9;
    outline:none;
  }
  input{ min-width:260px }
  input::placeholder{ color:#86cfa7; opacity:.8 }
  button{ cursor:pointer; transition: .15s transform, .15s background, .15s box-shadow }
  button:hover{ transform: translateY(-1px); box-shadow: 0 8px 24px rgba(37,211,102,.18) }
  .primary{ background: #128c7e; border-color:#128c7e }
  .ghost{ background: #0a1410 }
  .success{ color:#9dffbf }
  .error{ color:#ff9da8 }

  .qr{ display:none; margin-top:10px; width:min(300px,75vw); border-radius:10px; border:4px solid rgba(37,211,102,.35) }
  .tips{ opacity:.75; margin-top:8px; font-size:13px }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Rahl Quantum — Session Scanner</h1>
    <div class="sub">Choose <b>Pairing Code</b> or <b>QR</b>. The glowing ring shows live status.</div>

    <div class="panel">
      <div class="ring" id="ring">
        <div class="ring-core">
          <div class="status" id="status">SCANNER READY</div>
          <div class="tiny" id="sub">Waiting for action…</div>
          <div class="code" id="code" style="display:none"></div>
          <img id="qr" class="qr" alt="QR Code"/>
          <div class="controls">
            <input id="num" type="tel" inputmode="numeric" placeholder="Enter phone number e.g. 2547XXXXXXX"/>
            <button class="primary" id="btnPair">Get Pairing Code</button>
            <button class="ghost" id="btnQR">Use QR</button>
            <button class="ghost" id="btnCopy" style="display:none">Copy</button>
          </div>
          <div class="tips">Tip: Keep this tab open while generating.</div>
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);
  const statusEl = $("status");
  const subEl = $("sub");
  const codeEl = $("code");
  const qrEl = $("qr");
  const btnPair = $("btnPair");
  const btnQR = $("btnQR");
  const btnCopy = $("btnCopy");
  const numEl = $("num");

  // Helpers
  function setStatus(text, sub="", cls=""){
    statusEl.textContent = text;
    subEl.textContent = sub;
    subEl.className = cls || "";
  }
  function showCode(text){
    codeEl.style.display = "block";
    codeEl.textContent = text;
    btnCopy.style.display = "inline-block";
    qrEl.style.display = "none";
  }
  function showQRDataUrl(dataUrl){
    qrEl.src = dataUrl;
    qrEl.style.display = "block";
    codeEl.style.display = "none";
    btnCopy.style.display = "none";
  }

  // Copy
  btnCopy.addEventListener("click", async ()=>{
    try{
      await navigator.clipboard.writeText(codeEl.textContent);
      setStatus("COPIED ✅","Session/Pairing code copied.","success");
    }catch{
      setStatus("COPY FAILED","Long-press to copy manually.","error");
    }
  });

  // Pairing flow
  btnPair.addEventListener("click", async ()=>{
    const number = (numEl.value || "").trim();
    if(!number){ setStatus("NUMBER REQUIRED","Please enter your phone number.","error"); return; }

    setStatus("SCANNING…","Generating pairing code & notifying WhatsApp…");
    codeEl.style.display = "none"; btnCopy.style.display="none"; qrEl.style.display="none";

    try{
      const res = await fetch("/pair",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ number })
      });
      const data = await res.json();

      if(data.ok){
        // Show the code (we also DM the user from the backend)
        showCode(data.code);
        setStatus("PAIRING CODE READY","Open WhatsApp ➜ Link a device ➜ Paste code.","success");
      }else{
        setStatus("FAILED","" + (data.error || "Could not get code"),"error");
      }
    }catch(e){
      setStatus("NETWORK ERROR","Could not reach server.","error");
    }
  });

  // QR flow
  btnQR.addEventListener("click", async ()=>{
    setStatus("GENERATING QR…","Please wait while we fetch a QR.");
    codeEl.style.display = "none"; btnCopy.style.display="none"; qrEl.style.display="none";
    try{
      const res = await fetch("/qr");
      const data = await res.json();
      if(data.ok && data.qr){
        showQRDataUrl(data.qr);
        setStatus("SCAN WITH WHATSAPP","WhatsApp ➜ Linked devices ➜ Link a device.","success");
      }else{
        setStatus("FAILED","" + (data.error || "QR not available"),"error");
      }
    }catch(e){
      setStatus("NETWORK ERROR","Could not reach server.","error");
    }
  });
</script>
</body>
                                                     </html>
